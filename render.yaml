services:
  # Backend + Frontend (Web Service)
  - type: web
    name: security-webapp
    runtime: node
    region: frankfurt  # Cambia in 'oregon' o 'singapore' se preferisci
    plan: free  # Piano gratuito (750 ore/mese)
    branch: main  # Branch git da deployare
    buildCommand: npm install && npm install --prefix backend && npm install --prefix frontend && npm run build --prefix frontend && npm run build --prefix backend
    startCommand: cd backend && node dist/server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000  # Render usa la porta 10000 di default
      - key: CORS_ORIGIN
        value: https://security-webapp.onrender.com  # Cambia con il tuo URL Render
      - key: RATE_LIMIT_WINDOW_MS
        value: 900000
      - key: RATE_LIMIT_MAX_REQUESTS
        value: 100
      - key: NVD_API_KEY
        sync: false  # Opzionale, configurabile dal dashboard Render
    healthCheckPath: /health
    autoDeploy: true  # Deploy automatico ad ogni push su main

# Note:
# 1. Dopo il deploy, aggiorna CORS_ORIGIN con l'URL effettivo assegnato da Render
# 2. Il piano free si sospende dopo 15 minuti di inattivit√† (si riattiva in ~30s)
# 3. Render assegna automaticamente un URL tipo: https://security-webapp.onrender.com
# 4. Per dominio personalizzato, configuralo dal dashboard Render
